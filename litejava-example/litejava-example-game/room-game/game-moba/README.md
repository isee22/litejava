# Game MOBA - MOBA游戏服务器 (示例)

## 概述

MOBA 游戏服务器示例，展示帧同步架构，支持最多10人（5v5）。

**注意：这是一个简化的示例，用于演示帧同步游戏的基本架构。**

## 配置

```yaml
server:
  id: moba-1
  host: localhost
  wsPort: 9600
  httpPort: 9601

game:
  type: moba
  maxPlayers: 10
```

## 架构

```
┌─────────────────────────────────────────────────────────────┐
│                      帧同步架构                              │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  客户端1 ──┐                                                │
│  客户端2 ──┼──> 服务器收集输入 ──> 广播帧数据 ──> 所有客户端  │
│  客户端3 ──┘         │                                      │
│                      ▼                                      │
│              每帧 (如 66ms)                                  │
│              收集所有玩家输入                                 │
│              打包成帧数据                                    │
│              广播给所有客户端                                 │
│              客户端本地模拟                                  │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

## 游戏流程

```
1. 10人匹配成功
        │
        ▼
2. 选英雄阶段
   - 每人选择英雄
        │
        ▼
3. 加载阶段
   - 等待所有人加载完成
        │
        ▼
4. 游戏开始 (GAME_START)
   - 初始化地图
   - 生成小兵
        │
        ▼
5. 游戏循环 (帧同步)
   ┌─────────────────────────────────────┐
   │                                     │
   │  收集玩家输入 (MOVE/ATTACK/SKILL)   │
   │         │                           │
   │         ▼                           │
   │  打包成帧数据 (FRAME)               │
   │         │                           │
   │         ▼                           │
   │  广播给所有客户端                    │
   │         │                           │
   │         ▼                           │
   │  客户端本地模拟                      │
   │                                     │
   └─────────────────────────────────────┘
        │
        ▼
6. 游戏结束 (GAME_OVER)
   - 一方基地被摧毁
```

## 协议

### 命令号 (6000+)

| cmd | 名称 | 说明 |
|-----|------|------|
| 6001 | MOVE | 移动 |
| 6002 | ATTACK | 攻击 |
| 6003 | SKILL | 释放技能 |
| 6004 | ATTACK_BASE | 攻击基地 |
| 6010 | FRAME | 帧同步数据 |

### 移动 (cmd=6001)

```json
// 请求
{"cmd": 6001, "data": {"x": 100, "y": 200}}
```

### 攻击 (cmd=6002)

```json
// 请求
{"cmd": 6002, "data": {"targetId": 10002}}
```

### 技能 (cmd=6003)

```json
// 请求
{"cmd": 6003, "data": {"skillId": 1, "x": 150, "y": 250}}
```

### 帧数据 (cmd=6010)

```json
// 服务器广播
{
  "cmd": 6010,
  "data": {
    "frame": 100,
    "inputs": [
      {"userId": 10001, "cmd": 6001, "x": 100, "y": 200},
      {"userId": 10002, "cmd": 6002, "targetId": 10001},
      {"userId": 10003, "cmd": 6003, "skillId": 1, "x": 150, "y": 250}
    ]
  }
}
```

## 帧同步 vs 状态同步

| 特性 | 帧同步 | 状态同步 |
|-----|--------|---------|
| 服务器计算 | 少 | 多 |
| 带宽 | 低 | 高 |
| 延迟敏感 | 高 | 中 |
| 回放 | 简单 | 复杂 |
| 适用场景 | RTS/MOBA | MMO/FPS |

## 启动

```bash
mvn exec:java -pl game-moba -Dexec.mainClass=game.moba.MobaServer
```

## 注意事项

1. 这是简化示例，实际 MOBA 游戏需要更复杂的实现
2. 帧同步需要处理网络延迟、丢包、断线重连等问题
3. 客户端需要实现确定性模拟（相同输入产生相同结果）
