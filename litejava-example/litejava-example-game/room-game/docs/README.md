# Room Game 对接文档

房间制游戏服务端架构文档，支持多语言客户端和玩法服务器开发。

## 文档目录

| 文档 | 说明 | 适用对象 |
|------|------|----------|
| [客户端对接文档.md](./客户端对接文档.md) | 客户端对接文档 | 客户端开发者 |
| [游戏服务器协议.md](./游戏服务器协议.md) | 玩法服务器协议 | 玩法服务器开发者 |
| [斗地主协议.md](./斗地主协议.md) | 斗地主协议 | 斗地主玩法开发 |
| [五子棋协议.md](./五子棋协议.md) | 五子棋协议 | 五子棋玩法开发 |
| [麻将协议.md](./麻将协议.md) | 麻将协议 | 麻将玩法开发 |
| [狼人杀协议.md](./狼人杀协议.md) | 狼人杀协议 | 狼人杀玩法开发 |
| [德州扑克协议.md](./德州扑克协议.md) | 德州扑克协议 | 德州扑克玩法开发 |
| [牛牛协议.md](./牛牛协议.md) | 牛牛协议 | 牛牛玩法开发 |
| [MOBA协议.md](./MOBA协议.md) | MOBA协议 | MOBA玩法开发 |
| [部署指南-本地.md](./部署指南-本地.md) | 本地部署指南 | 运维/开发 |
| [部署指南-Docker.md](./部署指南-Docker.md) | Docker部署指南 | 运维/开发 |

## 架构概览

```
                    ┌─────────────────────────────────────┐
                    │            Gateway                  │
┌─────────────┐     │         (唯一入口)                  │
│   Client    │────▶│       ws://host:7100/ws             │
│  (Unity/H5) │     └─────────────────────────────────────┘
└─────────────┘                    │
                    ┌──────────────┼──────────────┐
                    ▼              ▼              ▼
             ┌─────────────┐ ┌─────────────┐ ┌─────────────┐
             │   Lobby     │ │   Match     │ │   Game      │
             │  (登录)     │ │  (匹配)     │ │  (游戏)     │
             └─────────────┘ └─────────────┘ └─────────────┘
                    │                              │
                    ▼              ┌───────────────┼───────────────┐
             ┌─────────────┐       ▼               ▼               ▼
             │   MySQL     │ ┌─────────────┐ ┌─────────────┐ ┌─────────────┐
             │   :3306     │ │  Doudizhu   │ │   Gobang    │ │   Mahjong   │
             └─────────────┘ │   :9100     │ │   :9200     │ │   :9300     │
                             └─────────────┘ └─────────────┘ └─────────────┘
```

**核心原则：客户端只连接 Gateway，所有后端服务对客户端不可见。**

- 回合制游戏（斗地主/麻将/五子棋）：Gateway 全代理
- MOBA/FPS 等实时游戏：匹配后直连 GameServer（低延迟）

## 服务列表

| 服务 | 端口 | 说明 | 客户端可见 |
|------|------|------|-----------|
| Registry | 8000 | 服务注册中心 | ❌ |
| Gateway | 7100(ws)/7101(http) | 网关，唯一入口 | ✅ |
| Lobby | 8100(ws)/8101(http) | 大厅，登录/玩家数据 | ❌ |
| Match | 8201(http) | 匹配服务 | ❌ |
| Doudizhu | 9100(ws)/9101(http) | 斗地主游戏服务器 | ❌ |
| Gobang | 9200(ws)/9201(http) | 五子棋游戏服务器 | ❌ |
| Mahjong | 9300(ws)/9301(http) | 麻将游戏服务器 | ❌ |
| MOBA | 9500(ws)/9501(http) | MOBA游戏服务器 | ✅ (直连) |

## 快速开始

```bash
# 1. 启动所有服务
./start-all.cmd

# 2. 客户端连接
ws://localhost:7100/ws
```

## 通信协议

所有 WebSocket 消息使用 JSON 格式：

```json
{
  "cmd": 1,        // 命令号
  "code": 0,       // 响应码 (0=成功)
  "data": {}       // 数据
}
```

## 错误码

| code | 说明 |
|------|------|
| 0 | 成功 |
| 1 | 未知错误 |
| 2 | 未登录 |
| 3 | 不在房间 |
| 4 | 已在匹配中 |
| 5 | 无可用服务器 |
| 20 | 房间不存在 |
| 21 | 房间已满 |
| 40+ | 游戏相关错误 |
