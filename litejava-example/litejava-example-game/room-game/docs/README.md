# Room Game 文档中心

## 文档目录

### 对接文档

| 文档 | 说明 | 适用对象 |
|------|------|----------|
| [客户端对接文档](./客户端对接文档.md) | 客户端接入指南 | 客户端开发者 |
| [游戏服务器协议](./游戏服务器协议.md) | 游戏服务器开发指南 | 后端开发者 |

### 游戏协议

| 文档 | 游戏 | 人数 |
|------|------|------|
| [斗地主协议](./game/斗地主协议.md) | 斗地主 | 3人 |
| [四人斗地主协议](./game/四人斗地主协议.md) | 四人斗地主 | 4人 |
| [五子棋协议](./game/五子棋协议.md) | 五子棋 | 2人 |
| [麻将协议](./game/麻将协议.md) | 麻将 | 4人 |
| [二人麻将协议](./game/二人麻将协议.md) | 二人麻将 | 2人 |
| [德州扑克协议](./game/德州扑克协议.md) | 德州扑克 | 6人 |
| [牛牛协议](./game/牛牛协议.md) | 牛牛 | 6人 |
| [狼人杀协议](./game/狼人杀协议.md) | 狼人杀 | 8人 |
| [MOBA协议](./game/MOBA协议.md) | MOBA | 10人 |

### 部署文档

| 文档 | 说明 |
|------|------|
| [部署指南-本地](./部署指南-本地.md) | 本地开发环境搭建 |
| [部署指南-Docker](./部署指南-Docker.md) | Docker 容器化部署 |
| [部署指南-Nginx](./部署指南-Nginx.md) | Nginx 反向代理配置 |

## 架构概览

```
┌─────────────────────────────────────────────────────────────────────┐
│                           客户端                                    │
│                                                                      │
│   HTTP (登录/匹配) ──────────────────────────────────────────────►  │
│   WebSocket (游戏) ──────────────────────────────────────────────►  │
└───────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌───────────────────────────────────────────────────────────────────────┐
│                         Nginx (生产环境)                              │
│                                                                       │
│   /api/account/*  ──►  AccountServer (8101)                          │
│   /api/hall/*     ──►  HallServer (8201)                             │
│   /game/*         ──►  GameServer (动态路由)                          │
└───────────────────────────────────────────────────────────────────────┘
                │                    │                    │
                ▼                    ▼                    ▼
┌──────────────────────┐  ┌──────────────────────┐  ┌──────────────────────┐
│    AccountServer     │  │     HallServer       │  │    GameServers       │
│    账号服务          │  │    大厅服务          │  │    游戏服务          │
│                      │  │                      │  │                      │
│  • 登录/注册         │  │  • 房间创建/加入      │  │  • Java (7个)        │
│  • 玩家数据          │  │  • 匹配系统          │  │  • Go (1个)          │
│  • 好友/排行榜       │  │  • 负载均衡          │  │  • Node.js (1个)     │
└──────────────────────┘  └──────────────────────┘  └──────────────────────┘
```

## 核心流程

### 1. 登录流程

```
客户端                    AccountServer
   │                           │
   │  POST /login              │
   │  {username, password}     │
   │ ─────────────────────────►│
   │                           │
   │  {userId, session, ...}   │
   │ ◄─────────────────────────│
```

### 2. 匹配流程

```
客户端                    HallServer                  GameServer
   │                           │                           │
   │  POST /match/start        │                           │
   │  {userId, gameType}       │                           │
   │ ─────────────────────────►│                           │
   │                           │                           │
   │                           │  (匹配成功，选择服务器)    │
   │                           │                           │
   │                           │  POST /create_room        │
   │                           │ ─────────────────────────►│
   │                           │                           │
   │                           │  {roomId}                 │
   │                           │ ◄─────────────────────────│
   │                           │                           │
   │  {roomId, ip, port, token}│                           │
   │ ◄─────────────────────────│                           │
```

### 3. 游戏流程

```
客户端                                            GameServer
   │                                                   │
   │  WebSocket ws://ip:port/game                      │
   │ ─────────────────────────────────────────────────►│
   │                                                   │
   │  {cmd: 1, data: {token: "xxx"}}                   │
   │ ─────────────────────────────────────────────────►│
   │                                                   │
   │  {cmd: 2, data: {roomInfo...}}                    │
   │ ◄─────────────────────────────────────────────────│
   │                                                   │
   │  {cmd: 504}  // 准备                              │
   │ ─────────────────────────────────────────────────►│
   │                                                   │
   │  {cmd: 510, data: {...}}  // 游戏开始             │
   │ ◄─────────────────────────────────────────────────│
   │                                                   │
   │  游戏操作 (cmd: 1000+)                            │
   │ ◄────────────────────────────────────────────────►│
```

## 协议格式

所有 WebSocket 消息使用 JSON 格式：

```json
{
  "cmd": 1,        // 命令号
  "code": 0,       // 响应码 (0=成功)
  "data": {}       // 数据
}
```

## 错误码

| code | 说明 |
|------|------|
| 0 | 成功 |
| 1 | 未知错误 |
| 2 | 未登录 |
| 3 | 不在房间 |
| 20 | 房间不存在 |
| 21 | 房间已满 |
| 40 | 不是你的回合 |
| 41 | 无效操作 |
