# 本地部署指南

本文档描述如何在本地开发环境部署 Room Game 服务。

## 前置条件

- JDK 8+
- Maven 3.6+
- MySQL 5.7+ (可选，用于持久化)

## 快速启动

### 1. 编译项目

```bash
cd room-game
mvn clean package -DskipTests
```

### 2. 启动服务

**Windows:**
```cmd
start-all.cmd
```

**PowerShell:**
```powershell
.\start-all.ps1
```

**手动启动 (按顺序):**

```bash
# 1. 注册中心
java -jar registry-server/target/registry-server.jar

# 2. 大厅服务
java -jar lobby-server/target/lobby-server.jar

# 3. 网关服务
java -jar gateway-server/target/gateway-server.jar

# 4. 匹配服务
java -jar match-server/target/match-server.jar

# 5. 游戏服务 (按需启动)
java -jar game-doudizhu/target/game-doudizhu.jar
java -jar game-gobang/target/game-gobang.jar
java -jar game-mahjong/target/game-mahjong.jar
```

### 3. 验证服务

```bash
# 检查注册中心
curl http://localhost:8000/services

# 检查网关
curl http://localhost:7101/health

# 检查大厅
curl http://localhost:8101/health
```

## 服务端口

| 服务 | WS端口 | HTTP端口 |
|------|--------|----------|
| Registry | - | 8000 |
| Gateway | 7100 | 7101 |
| Lobby | 8100 | 8101 |
| Match | 8200 | 8201 |
| Doudizhu | 9100 | 9101 |
| Gobang | 9200 | 9201 |
| Mahjong | 9300 | 9301 |

## 配置文件

每个服务的配置文件位于 `src/main/resources/application.yml`：

```yaml
server:
  wsPort: 9100
  httpPort: 9101

registry:
  url: http://localhost:8000

game:
  type: doudizhu
  maxPlayers: 3
```

## 数据库配置 (可选)

如需持久化玩家数据，配置 MySQL：

```yaml
# lobby-server/src/main/resources/application.yml
database:
  url: jdbc:mysql://localhost:3306/room_game
  username: root
  password: 123456
```

初始化数据库：

```bash
mysql -u root -p < lobby-server/src/main/resources/schema.sql
```

## 停止服务

**Windows:**
```cmd
stop-all.cmd
```

**手动停止:**
```bash
# 查找进程
jps -l | grep game

# 终止进程
taskkill /F /PID <pid>
```

## 常见问题

### Q: 端口被占用
```bash
# 查看端口占用
netstat -ano | findstr :8000

# 终止占用进程
taskkill /F /PID <pid>
```

### Q: 服务注册失败
确保 Registry 服务先启动，其他服务才能注册。

### Q: 匹配不成功
检查是否有足够的游戏服务器实例运行。
