# 斗地主协议文档

本文档描述斗地主游戏的通信协议，适用于客户端开发和其他语言实现斗地主服务器。

## 1. 游戏流程

```
准备 → 发牌 → 叫分 → 出牌 → 结算
```

## 2. 命令号

| cmd | 名称 | 方向 | 说明 |
|-----|------|------|------|
| 400 | GAME_START | S→C | 游戏开始 |
| 401 | GAME_OVER | S→C | 游戏结束 |
| 410 | DEAL | S→C | 发牌 |
| 1001 | BID | C→S | 叫地主 |
| 1002 | BID_RESULT | S→C | 叫分结果 |
| 1003 | PLAY | C→S | 出牌 |
| 1004 | PLAY_RESULT | S→C | 出牌结果 |
| 1005 | PASS | C→S | 不出 |

## 3. 协议详情

### 3.1 发牌 (DEAL)
```json
{
  "cmd": 410,
  "data": {
    "cards": [3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17]
  }
}
```

### 3.2 叫地主 (BID)
```json
// 请求
{ "cmd": 1001, "data": { "bid": true } }

// 响应
{
  "cmd": 1002,
  "data": {
    "seatIndex": 0,
    "bid": true,
    "nextSeat": 1,
    "landlordSeat": -1,
    "bottomCards": null
  }
}
```

### 3.3 出牌 (PLAY)
```json
// 请求
{ "cmd": 1003, "data": { "cards": [3, 3, 3] } }

// 响应
{
  "cmd": 1004,
  "data": {
    "seatIndex": 0,
    "cards": [3, 3, 3],
    "pass": false,
    "nextSeat": 1,
    "remainCards": 14
  }
}
```

### 3.4 游戏结束 (GAME_OVER)
```json
{
  "cmd": 401,
  "data": {
    "winner": 0,
    "landlordSeat": 0,
    "scores": [200, -100, -100],
    "spring": false
  }
}
```

## 4. 牌值编码

```
牌值 = 花色 * 13 + 点数

花色: 0=方块, 1=梅花, 2=红桃, 3=黑桃
点数: 0=3, 1=4, ..., 12=2

特殊: 52=小王, 53=大王
```

## 5. 牌型

| 牌型 | 说明 |
|------|------|
| 单张 | 1张 |
| 对子 | 2张相同 |
| 三张 | 3张相同 |
| 三带一/二 | 3张+1/2张 |
| 顺子 | 5+张连续 |
| 连对 | 3+对连续 |
| 飞机 | 2+个三张连续 |
| 炸弹 | 4张相同 |
| 王炸 | 双王 |

## 6. 错误码

| code | 说明 |
|------|------|
| 43 | 不是你的回合 |
| 45 | 无效牌型 |
| 46 | 不能过牌 |
| 47 | 打不过 |
