# 游戏服务器架构对比

## 两种主流架构

| 对比项 | 房间制 (Room-Based) | MMORPG (大世界) |
|--------|---------------------|-----------------|
| **代表游戏** | 棋牌、DOTA2、王者荣耀、战旗、炉石 | 魔兽世界、原神、传奇 |
| **世界模型** | 独立房间，互相隔离 | 统一大世界，玩家共存 |
| **状态持久** | 局内临时，局外持久 | 全程持久 |
| **同步范围** | 房间内全量同步 | AOI 区域同步 |
| **扩展方式** | 加房间服务器 | 分线/分区/跨服 |
| **复杂度** | 低 | 高 |

## 房间制架构

### 适用游戏类型

| 类型 | 游戏示例 | 特点 |
|------|---------|------|
| 棋牌 | 斗地主、麻将、德州 | 回合制、规则简单 |
| MOBA | DOTA2、王者荣耀、LOL | 实时对战、10人房间 |
| FPS | CS、PUBG、和平精英 | 实时射击、房间人数多 |
| 战旗 | 火焰纹章、XCOM、云顶之弈 | 回合制策略 |
| 卡牌 | 炉石、游戏王、三国杀 | 回合制、规则复杂 |
| 休闲 | 飞行棋、大富翁 | 回合制、轻量 |

### 架构图

```
                           ┌─────────────────────────────────────┐
                           │            负载均衡器                │
                           └──────────────┬──────────────────────┘
                                          │
              ┌───────────────────────────┼───────────────────────────┐
              │                           │                           │
     ┌────────▼────────┐        ┌────────▼────────┐        ┌────────▼────────┐
     │   网关服务器 1   │        │   网关服务器 2   │        │   网关服务器 N   │
     │  (连接管理)      │        │  (连接管理)      │        │  (连接管理)      │
     └────────┬────────┘        └────────┬────────┘        └────────┬────────┘
              │                           │                           │
              └───────────────────────────┼───────────────────────────┘
                                          │
                           ┌──────────────▼──────────────┐
                           │        匹配服务器            │
                           │   (房间分配、玩家匹配)        │
                           └──────────────┬──────────────┘
                                          │
              ┌───────────────────────────┼───────────────────────────┐
              │                           │                           │
     ┌────────▼────────┐        ┌────────▼────────┐        ┌────────▼────────┐
     │   房间服务器 1   │        │   房间服务器 2   │        │   房间服务器 N   │
     │ ┌─────┐ ┌─────┐ │        │ ┌─────┐ ┌─────┐ │        │ ┌─────┐ ┌─────┐ │
     │ │Room1│ │Room2│ │        │ │Room3│ │Room4│ │        │ │RoomN│ │... │ │
     │ └─────┘ └─────┘ │        │ └─────┘ └─────┘ │        │ └─────┘ └─────┘ │
     └─────────────────┘        └─────────────────┘        └─────────────────┘
                                          │
                           ┌──────────────▼──────────────┐
                           │         数据服务            │
                           │   Redis + MySQL + MQ       │
                           └─────────────────────────────┘
```

### 核心流程

```
1. 玩家连接 → 网关服务器
2. 请求匹配 → 匹配服务器
3. 分配房间 → 房间服务器
4. 游戏进行 → 房间内同步
5. 游戏结束 → 结算、销毁房间
```

---

## MMORPG 架构

### 适用游戏类型

| 类型 | 游戏示例 | 特点 |
|------|---------|------|
| 传统MMO | 魔兽世界、剑网三 | 大世界、副本、公会 |
| 开放世界 | 原神、塞尔达 | 探索、剧情、联机 |
| 传奇类 | 传奇、奇迹 | PK、打宝、攻城 |
| 仙侠 | 诛仙、完美世界 | 飞行、帮派、跨服 |

### 架构图

```
                           ┌─────────────────────────────────────┐
                           │            负载均衡器                │
                           └──────────────┬──────────────────────┘
                                          │
              ┌───────────────────────────┼───────────────────────────┐
              │                           │                           │
     ┌────────▼────────┐        ┌────────▼────────┐        ┌────────▼────────┐
     │   网关服务器 1   │        │   网关服务器 2   │        │   网关服务器 N   │
     └────────┬────────┘        └────────┬────────┘        └────────┬────────┘
              │                           │                           │
              └───────────────────────────┼───────────────────────────┘
                                          │
     ┌────────────────────────────────────┼────────────────────────────────────┐
     │                                    │                                    │
     │  ┌─────────────────────────────────▼─────────────────────────────────┐  │
     │  │                         世界服务器                                 │  │
     │  │  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐             │  │
     │  │  │ 场景服务1 │ │ 场景服务2 │ │ 场景服务3 │ │ 副本服务  │             │  │
     │  │  │ (主城)   │ │ (野外)   │ │ (战场)   │ │ (实例)   │             │  │
     │  │  └──────────┘ └──────────┘ └──────────┘ └──────────┘             │  │
     │  └─────────────────────────────────────────────────────────────────┘  │
     │                                    │                                    │
     │  ┌─────────────────────────────────▼─────────────────────────────────┐  │
     │  │                         功能服务器                                 │  │
     │  │  ┌──────┐ ┌──────┐ ┌──────┐ ┌──────┐ ┌──────┐ ┌──────┐          │  │
     │  │  │ 聊天 │ │ 公会 │ │ 好友 │ │ 邮件 │ │ 排行 │ │ 商城 │          │  │
     │  │  └──────┘ └──────┘ └──────┘ └──────┘ └──────┘ └──────┘          │  │
     │  └─────────────────────────────────────────────────────────────────┘  │
     │                                    │                                    │
     └────────────────────────────────────┼────────────────────────────────────┘
                                          │
                           ┌──────────────▼──────────────┐
                           │         数据服务            │
                           │   Redis + MySQL + MQ       │
                           └─────────────────────────────┘
```

### AOI (Area of Interest) 同步

```
┌─────────────────────────────────────────────────────────┐
│                      大世界地图                          │
│  ┌─────────┬─────────┬─────────┬─────────┬─────────┐   │
│  │  格子1  │  格子2  │  格子3  │  格子4  │  格子5  │   │
│  │         │   👤A   │         │         │         │   │
│  ├─────────┼─────────┼─────────┼─────────┼─────────┤   │
│  │  格子6  │  格子7  │  格子8  │  格子9  │  格子10 │   │
│  │         │   👤B   │   👤C   │         │         │   │
│  ├─────────┼─────────┼─────────┼─────────┼─────────┤   │
│  │  格子11 │  格子12 │  格子13 │  格子14 │  格子15 │   │
│  │         │         │         │   👤D   │         │   │
│  └─────────┴─────────┴─────────┴─────────┴─────────┘   │
│                                                         │
│  玩家 A 的 AOI 范围: 格子 1,2,3,6,7,8 (九宫格)           │
│  A 只能看到 B，看不到 C、D                               │
└─────────────────────────────────────────────────────────┘
```

---

## 技术选型对比

| 技术点 | 房间制 | MMORPG |
|--------|--------|--------|
| **网络协议** | TCP/WebSocket | TCP |
| **序列化** | Protobuf/JSON | Protobuf |
| **同步模式** | 帧同步/状态同步 | 状态同步 |
| **存储** | Redis (局内) + MySQL (局外) | Redis + MySQL + 分库分表 |
| **消息队列** | 可选 | 必须 (跨服通信) |
| **定时器** | 简单 | 复杂 (大量定时任务) |

## 选型建议

| 场景 | 推荐架构 |
|------|---------|
| 棋牌、卡牌 | 房间制 |
| MOBA、FPS | 房间制 |
| 战旗、SLG | 房间制 |
| 休闲对战 | 房间制 |
| 大世界 RPG | MMORPG |
| 沙盒生存 | MMORPG |
| 社交游戏 | MMORPG |
